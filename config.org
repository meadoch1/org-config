#+TITLE: config.el
#+PROPERTY: header-args :tangle yes

#+BEGIN_SRC elisp
  (with-eval-after-load 'org
#+END_SRC

* Table of Contents :TOC_4_gh:
- [[#encryption][Encryption]]
- [[#look-and-feel][Look and feel]]
- [[#journal][Journal]]
- [[#keywords][Keywords]]
- [[#link-abbreviations][Link abbreviations]]
- [[#capture][Capture]]
  - [[#templates][Templates]]
    - [[#generic-meeting][Generic Meeting]]
    - [[#cfengine-customer-status-check-in][CFEngine Customer Status Check-in]]
    - [[#cfengine-backlog-grooming][CFEngine Backlog Grooming]]
    - [[#unorganized][Unorganized]]
  - [[#configure-capture][Configure Capture]]
- [[#babel-src-blocks][Babel (SRC blocks)]]
- [[#exporting][Exporting]]
  - [[#publishing][Publishing]]
- [[#agenda][Agenda]]
- [[#clocking][Clocking]]
- [[#downloading][Downloading]]
  - [[#pictures][Pictures]]
- [[#jira][Jira]]
- [[#for-the-future][For the future]]
- [[#eof][EOF]]

* Encryption
:PROPERTIES:
:ID:       b4bded6c-9d3a-4570-9cc0-ae011226399b
:END:
 
GPG can be used to automatically encrypt sections of text tagged with /*crypt*/.

#+BEGIN_SRC elisp
  (require 'org-crypt)
  (org-crypt-use-before-save-magic)
  (setq org-tags-exclude-from-inheritance (quote ("crypt")))
  (setq org-crypt-key "9274E588E866A10B713C9CCD9EB3AD425D1CCC11")
#+END_SRC

* Look and feel
:PROPERTIES:
:ID:       7d815734-bf0e-4620-89e6-910416ec7cc6
:END:

#+BEGIN_SRC elisp
  ;; BEGIN org niceities
  (setq org-tags-match-list-sublevels 'indented)
  (setq org-startup-indented t)
  (setq org-startup-with-inline-images t)

  ;; Familiar zooming with Ctrl+ and Ctrl-
  (define-key global-map (kbd "C-+") 'text-scale-increase)
  (define-key global-map (kbd "C--") 'text-scale-decrease)

  (setq org-insert-heading-respect-content t)
  (setq org-id-link-to-org-use-id t)
  (setq org-id-track-globally t)
  ;; END org niceities
#+END_SRC

* Journal
:PROPERTIES:
:ID:       778fcfc3-5ca1-4af1-86a1-654c97260f3a
:END:

These need to be set earlier, like with the layer specification, for example:

#+BEGIN_SRC elisp :tangle no
  (org :variables
    org-enable-reveal-js-support t
    org-enable-org-journal-support t)
#+END_SRC 

#+BEGIN_SRC elisp
  (setq org-journal-dir "~/org/journal/")
  (setq org-journal-file-format "%Y-%m-%d")
  (setq org-journal-date-prefix "#+TITLE: ")
  (setq org-journal-date-format "%A, %B %d %Y")
  (setq org-journal-time-prefix "* ")
  (setq org-journal-time-format "")
  (setq org-want-todo-bindings t)
#+END_SRC
  
* ToDO Keywords
:PROPERTIES:
:ID:       9f7dc47a-843d-4d2d-8178-3053c57c30bf
:END:
  
#+BEGIN_SRC elisp
  ;; TODO Keywords
  (setq org-todo-keywords
        (quote ((sequence "TODO(t)" "IN_PROGRESS(i)" "|" "DONE(d)")
                (sequence "WAITING(w@/)" "DELEGATED(D)" "HOLD(h@/)" "|" "CANCELLED(c@/)"))))

  ;; This conflicts with the evil key bindings in spacemacs, instead of using the old speedcommands, use =, T T= when inside org mode.
  ;;(setq org-use-fast-todo-selection t)
  ;;(setq org-use-speed-commands t)

#+END_SRC

* Link abbreviations
:PROPERTIES:
:ID:       83e904da-0e44-4629-942f-c3a390e227fb
:END:
  
#+BEGIN_SRC elisp
      ;; Link abbreviations http://orgmode.org/manual/Link-abbreviations.html#Link-abbreviations
      ;; This makes it easy to create links in org files to common urls
      ;; Note: The actual link is not stored in the text, only when rendered
      ;; Usage: [[zendesk:2753]] or [[redmine:7481][My text]]
      (setq org-link-abbrev-alist
            '(
              ("cfe-func" . "https://docs.cfengine.com/docs/master/reference-functions-")
              ("zendesk" . "https://cfengine.zendesk.com/agent/tickets/")
              ("redmine" . "https://dev.cfengine.com/issues/")
              ("core-pr" . "https://github.com/cfengine/core/pull/")
              ("mpf-pr" . "https://github.com/cfengine/masterfiles/pull/")
              ("core-commit" . "https://github.com/cfengine/core/commit/")
              ("mpf-commit" . "https://github.com/cfengine/masterfiles/commit/")
              ("jira" . "https://tracker.mender.io/browse/")))
#+END_SRC

* Capture
:PROPERTIES:
:ID:       c6f828da-99c2-4354-80ef-9ab57c9f702d
:END:
I use capture templates to help me get information for common things in a
consistent way. I have capture templates for various types of meetings, and
different types of tasks that I work on.

** Templates
Tempalates can be external, probably it would be a good idea to try moving to
external template files instead of having huge templates in elisp. [[https://www.reddit.com/r/emacs/comments/7zqc7b/share_your_org_capture_templates/duqzj0r/][This post
from reddit.com/emacs]] shows an example using external templates

*** Generic Meeting
:PROPERTIES:
:ID:       4b0d8c14-b69a-4956-8874-10b3d7641c99
:END:
#+BEGIN_SRC elisp
  (defvar my/org-meeting-template-generic "* %u %^{Meeting about} %^g
  CREATED: %U

  %?

  ,** Notes


  " "Meeting Template - Generic")
#+END_SRC

*** CFEngine Customer Status Check-in
:PROPERTIES:
:ID:       6dcf9681-425f-4bdc-8ded-c72f3ada392d
:END:
#+BEGIN_SRC elisp
  (defvar my/org-meeting-template-customer-status "* %u Status Check-in
  %^{CUSTOMER}pCREATED: %U

  %?

  ,*Attendees:*
    - Nick Anderson
    -

  ,** Info
  - Current versions running:
  - Next planned upgrade:
  - Upcoming platform changes:

  ,** Notes

  " "Meeting Template - Customer Status Check-in")
#+END_SRC

*** CFEngine Backlog Grooming
:PROPERTIES:
:ID:       5f77724f-afa8-47bc-a858-32396a37472c
:END:

Bi-weekly meeting to make sure we are ready to work on our planned tasks.

*Agenda:*

- [[https://tracker.mender.io/issues/?filter=11300][Review New customer issues]]
- [[https://tracker.mender.io/secure/RapidBoard.jspa?rapidView=34][Review Progress on CFEngine Epics]]
- [[https://tracker.mender.io/issues/?filter=11205][Review Understanding of Next Bugs]]
- [[https://tracker.mender.io/secure/RapidBoard.jspa?rapidView=11&view=planning&epics=visible][Review CFEngine PM Backlog]]

#+BEGIN_SRC elisp
  (defvar my/org-meeting-template-grooming "* %u Meeting About CFEngine Grooming :internal_meeting:
  CREATED: %U
  %?
  ,*Agenda:*
  - [[https://tracker.mender.io/issues/?filter=11300][Review New customer issues]]
  - [[https://tracker.mender.io/secure/RapidBoard.jspa?rapidView=34][Review Progress on CFEngine Epics]]
  - [[https://tracker.mender.io/issues/?filter=11205][Review Understanding of Next Bugs]]
  - [[https://tracker.mender.io/secure/RapidBoard.jspa?rapidView=11&view=planning&epics=visible][Review CFEngine PM Backlog]]

  ,** Notes

  " "Meeting Template - Grooming")
#+END_SRC

*** Unorganized
:PROPERTIES:
:ID:       78db44bb-8de4-4da9-bb90-fd6e235f1e26
:END:
#+BEGIN_SRC elisp
      ;; BEGIN Capture Templates
      ;; I picked up this neat trick from the Venerable Sacha Chua
      (defvar my/org-meeting-template-planning "* %u Meeting About CFEngine Planning   %^G
  CREATED: %U

  ,*Agenda:*
   - Demos
   - Review work in progress
   - Review newly registered issues

  ,** Demos


  " "Meeting Template - Planning")

      (defvar my/org-meeting-template-standup "* %u CFEngine Standup  :internal_meeting:
  CREATED: %U

  ,** Aleksei
  ,** Igor
  ,** Ole
  ,** Vratislav
  ,** Nils 
  ,** Craig
  ,** Nick

  " "Meeting Template - Standup")

      (defvar my/org-meeting-template "* %u %^{Meeting About ...}   %^G
  CREATED: %U

  ,*Attendees:*

   - [X] Nick Anderson
   - [ ] %?


  ,*Agenda:*
   -
   -

  ,*Notes:*


  " "Meeting Template")

      (defvar my/org-contact-capture-template "* %(org-contacts-template-name)
  CREATED: %U
  :PROPERTIES:
  :EMAIL: %(org-contacts-template-email)
  :END:")


      (defvar my/org-respond-email-capture-template "** TODO [#B] Respond to %:from on %:subject\nSCHEDULED: %t\n%U\n%a\n\n")

      (defvar my/org-capture-support "** TODO [#A] [[zendesk:%^{ISSUE}]]: %^{DESCRIPTION} %^G\n\n%?\n")
      (defvar my/org-capture-jira "** TODO [#B] [[jira:%^{ISSUE}]]: %^{DESCRIPTION} %^G\n\n%?\n")


      (defvar my/org-daily-review-capture-template "* %u\n\n%?\n")

#+END_SRC
** Configure Capture
:PROPERTIES:
:ID:       8bbfa3e2-4ad1-4cb5-ac24-9c2deeef5f37
:END:

I clock my time so that it's easier for me to look back and see what I was
working on, so I have all of my capture templates clock in during capture, and
then resume the clock for whatever was being clocked before the capture.

#+BEGIN_SRC elisp
  ;; Configure custom capture templates
  (setq org-capture-templates
        `(;; Note the backtick here, it's required so that the defvar based tempaltes will work!
          ;;http://comments.gmane.org/gmane.emacs.orgmode/106890

          ("t" "To-do" entry (file+headline "~/org/refile.org" "Tasks")
           "** TODO %^{Task Description}\nCreated From: %a\n%?\n\n" :clock-in t :clock-resume t :append t)

          ("s" "Support" entry (file+headline "~/org/refile.org" "Tasks")
           ,my/org-capture-support :clock-in t :clock-resume t :append t)

          ("j" "Jira" entry (file+headline "~/org/refile.org" "Tasks")
           ,my/org-capture-jira :clock-in t :clock-resume t :append t)

          ("w" "Web site" entry
           (file "~/org/websites.org")
           "* %a :website:\n\n%U %?\n\n%:initial" :append t)

          ("r" "Respond to Email" entry (file+headline "~/org/refile.org" "Tasks")
           ,my/org-respond-email-capture-template :clock-in t :clock-resume t :append t)

          ("c" "Contact" entry (file "~/org/x-files.org") ,my/org-contact-capture-template :append t)
          ("d" "Daily Review" entry (file "~/org/daily_reviews.org") ,my/org-daily-review-capture-template :clock-in t :clock-resume t :append t)

          ("m" "Meetings" )
          ("ms" "Meeting - Standup" entry (file "~/org/cfengine/meetings.org" )
           ,my/org-meeting-template-standup :clock-in t :clock-resume t :append t :empty-lines-after 1)
          ("mc" "Meeting - Customer Status Check-in" entry (file "~/org/cfengine/meetings.org" )
           ,my/org-meeting-template-customer-status :clock-in t :clock-resume t :append t :empty-lines-after 1)
          ("mg" "Meeting - Grooming" entry (file "~/org/cfengine/meetings.org" )
           ,my/org-meeting-template-grooming :clock-in t :clock-resume t :append t :empty-lines-after 1)
          ("mp" "Meeting - Planning/Review" entry (file "~/org/cfengine/meetings.org" )
           ,my/org-meeting-template-planning :clock-in t :clock-resume t :append t :empty-lines-after 1)
          ("mm" "Meeting - Generic" entry (file "~/org/cfengine/meetings.org" )
           ,my/org-meeting-template-generic :clock-in t :clock-resume t :append t :empty-lines-after 1)
          ))
  ;; END Capture templates
  ;; Use UUIDs to identify each speicifc entry
  (add-hook 'org-capture-prepare-finalize-hook 'org-id-get-create)
#+END_SRC

* Babel (SRC blocks)                                                 :ATTACH:
:PROPERTIES:
:ID:       01434efa-906d-4cde-893a-ce3ad19ceff2
:Attachments: screenshot_2018-10-30_20-56-48.png
:END:

I use SRC blocks a *lot*. 

=org-src-fontify-natively= makes syntax highlighting work within SRC blocks.

#+DOWNLOADED: /tmp/screenshot.png @ 2018-10-30 20:56:48
[[file:data/01/434efa-906d-4cde-893a-ce3ad19ceff2/screenshot_2018-10-30_20-56-48.png]]

#+BEGIN_SRC elisp
  (setq org-src-fontify-natively t)
#+END_SRC

Similarly, =org-src-tab-acts-natively= maks tab behave like the language of the
SRC block. This is handy for properly managing indention for code within a SRC
block.

#+BEGIN_SRC elisp
  (setq org-src-tab-acts-natively t)
#+END_SRC

Here we configure the languages supported by SRC blocks.

#+BEGIN_SRC elisp
  (org-babel-do-load-languages
   'org-babel-load-languages
   '(
     (shell . t) ; Works for sh, shell, bash
     ;; (python . t)
     ;; (ruby . t)
     ;; (ditaa . t)
     ;; (http . t)
     ;; (plantuml . t)
     ;; (perl . t))
     ))

  ;; This is no longer needed. It's handled by the cfengine layer automatically if
  ;; it sees the org layer is also used.
  ;; https://github.com/syl20bnr/spacemacs/pull/11528
  ;; (when (configuration-layer/layer-usedp 'cfengine)
  ;;   ;;(require 'ob-cfengine3) ;; I have problems with capture templates if I don't
  ;;   ;; use this before capturing or require it.

  ;;   (append org-babel-load-languages
  ;;           '((cfengine3 . t)))
  ;;   )
#+END_SRC

#+BEGIN_SRC cfengine3 :exports both :tangle no
  bundle agent main
  {
      reports:
        "Hello world";
  }
#+END_SRC

#+RESULTS:
: R: Hello world

* Exporting
:PROPERTIES:
:ID:       fb4ea199-89f2-4cc7-ba97-0a296e72aec7
:END:
  
#+BEGIN_SRC elisp
  ;; BEGIN exports
  ;; Disable exporting subscripts (I use a lot of underscores, and they are never for subscript)
  (setq org-export-with-sub-superscripts nil)

  (when (configuration-layer/package-usedp 'ox-jira)
    (add-to-list 'org-export-backends 'jira))

  (when (configuration-layer/layer-usedp 'markdown)
    (add-to-list 'org-export-backends 'md))

  ;; END exports 
#+END_SRC

** Publishing
:PROPERTIES:
:ID:       b87b7b21-cc07-4db3-b883-5fcfd194de57
:END:
   
#+BEGIN_SRC elisp
  ;; BEGIN Publishing
  (setq org-publish-project-alist
        '(
          ("journal"
           :base-directory "~/org/journal/"
           :base-extension ""
           :publishing-directory "~/journal/"
           :recursive t
           :publishing-function org-html-publish-to-pdf
           :headline-levels 1
           :autopreamble nil)
          ("cfengine-html"
           :base-directory "~/org/cfengine/"
           :base-extension "org"
           :publishing-directory "~/CFEngine/Google Drive/nicks_org"
           :recursive t
           :publishing-function org-html-publish-to-html
           :headline-levels 4
           :autopreamble t
           :eval "never-export")
          ("cfengine-org"
           :base-directory "~/org/cfengine/"
           :base-extension "org"
           :publishing-directory "~/CFEngine/Google Drive/nicks_org"
           :recursive t
           :publishing-function org-org-publish-to-org
           :headline-levels 4
           :autopreamble t)
          ("cfengine-pdf"
           :base-directory "~/org/cfengine/"
           :base-extension "org"
           :publishing-directory "~/CFEngine/Google Drive/nicks_org"
           :recursive nil
           :publishing-function org-latex-publish-to-pdf
           :headline-levels 4
           :autopreamble t)
          ("cfengine-txt"
           :base-directory "~/org/cfengine/"
           :base-extension "org"
           :publishing-directory "~/CFEngine/Google Drive/nicks_org"
           :recursive t
           :publishing-function org-ascii-publish-to-utf8
           :headline-levels 4
           :autopreamble t)

          ))
  ;; END Publishing
  ;; BEGIN org-agenda configuration
#+END_SRC

* Agenda :ATTACH:
:PROPERTIES:
:ID:       fbd97b7f-c136-4069-95d3-42f4804d0f85
:Attachments: 2018-10-22-05-30_2018-10-30_22-08-02.png
:END:
I have been trying to learn the agenda for some time now, I just haven't been
able to make it stick in my workflow. I take notes in org for most things that I
am doing, and my working set of org files is about 20M.

#+BEGIN_SRC shell
  find ~/org -type f -name '*.org' -exec du -ch {} + | grep total$
  find ~/org -type f -name '*.org_archive' -exec du -ch {} + | grep total$
#+END_SRC

#+RESULTS:
| 13M  | total |
| 4.3M | total |

This helps me to both focus on todays stuff, and to reduce the time to build the
agenda.

#+BEGIN_SRC elisp
 (setq org-agenda-span 'day)
#+END_SRC

#+BEGIN_SRC elisp
  (setq org-agenda-files
        '("~/org" "~/org/cfengine" "~/org/cfengine/customers" "~/.org-jira"))
  ;; It's hard to see them (at least with the default color). Also this is a
  ;; reccomended change to speed up the agenda (not that it's too slow for me).
  (setq org-agenda-dim-blocked-tasks nil)
  (setq org-agenda-prefix-format '"%b")
  ;; END org-agenda configuration
#+END_SRC

=org-timeline= shows a visualization of time spent throughout the day. For
example, here I see that I worked from 11:45-3:00 of non-stopped clocked time.

#+DOWNLOADED: file:///home/nickanderson/Pictures/Screenshots/2018-10-22-05-30.png @ 2018-10-30 22:08:02
[[file:data/fb/d97b7f-c136-4069-95d3-42f4804d0f85/2018-10-22-05-30_2018-10-30_22-08-02.png]]

#+BEGIN_SRC elisp
  (when (configuration-layer/package-used-p 'org-timeline)
    (require 'org-timeline)
    (add-hook 'org-agenda-finalize-hook 'org-timeline-insert-timeline :append)
    )
#+END_SRC

* Clocking
:PROPERTIES:
:ID:       627db646-a768-4d75-a0dd-ac752133da47
:END:
#+BEGIN_SRC elisp
  ;; BEGIN clocking configuration
  (setq spaceline-org-clock-p t)
  (setq org-clock-idle-time 15)
  (setq org-time-clocksum-format (quote (:hours "%d" :require-hours t :minutes ":%02d" :require-minutes t)))
  ;; END clocking configuration
#+END_SRC

* Downloading
** Pictures
:PROPERTIES:
:ID:       130cbfea-a505-4129-bbc9-97b88ff9ad2e
:END:
[[https://github.com/abo-abo/org-download][org-download]] is installed by the org layer, it makes getting images into your
buffer from a URL or a screenshot easy. I like to use org-attach for storing the
images. It stores them in a tree based on the entrys UUID.

Use ~org-download-yank~ to grab an image, and ~org-download-screenshot~ to take
a screenshot.

#+BEGIN_SRC elisp
  (setq org-download-method 'attach)
#+END_SRC
* Jira
:PROPERTIES:
:ID:       acaa5143-4727-4511-b345-5a8dbbd44862
:END:

#+BEGIN_SRC elisp
  (when (configuration-layer/package-usedp 'org-jira)
    (org-jira :variables
              jiralib-url "https://tracker.mender.io:443"
              org-jira-working-dir "~/.org-jira"))
#+END_SRC

* For the future
- org-board :: Archive webpages

- org-clock-conveniance :: Functions to help manage clock times. Currently I
     clock automatically, and I don't fret too much about accuracy. But if I
     want to improve my clocking, this may be useful for ammending mistakes.

- org-gcal :: For integrating google calendar into org-mode, perhaps when I get
              better with agenda.

* EOF
:PROPERTIES:
:ID:       db85d403-eff0-4059-b44c-fa77a94abd44
:END:
#+BEGIN_SRC elisp
  )
#+END_SRC
